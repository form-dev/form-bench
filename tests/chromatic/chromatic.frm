#-

#: ScratchSize 1G
#: LargeSize 2G
#: LargePatches 1024
#: TermsInSmall 5M
#: SmallSize 1G

* Test based on p15.frm "Chromatic Polynomials"
#define N "14"
#define D "2"

CFunctions acc;
Tensors e,d;
Symbols x,q,[q-1];
Indices k,k0,...,k{`N'^`D'+`N'^{`D'-1}-1};
set kk0:k0,...,k{`N'^`D'-1};
#do d = 1,`D'
set kk`d':
#do i = 0,`N'^`D'-1
  #if ( {(`i'/{`N'^{`d'-1}})%`N'} != {`N'-1} )
		k{`i'+`N'^{`d'-1}}
  #else
		k
  #endif
#enddo
	;
#enddo
Off Statistics;
Format nospaces;
Format 240;
*
*	Program 15.
*	Modified loop. Restriction to selected d.
*
#do i = 0,`N'^`D'-1
L   F`i' = 1
#do j = 1,`D'
  #if ( {(`i'/{`N'^{`j'-1}})%`N'} != {`N'-1} )
            *e(k`i',k{`i'+`N'^{`j'-1}})
  #endif
#enddo
        ;
#enddo
id  e(k?,k1?) = 1-d(k,k1);
repeat id  d(k?,?a)*d(k?,?b) = d(k,?a,?b);
.sort
PolyFun acc;
Hide;
L	F = 1;
#do i = 0,`N'^`D'-1
  #printtimes
  #message iter `i'/{`N'^`D'-1}
  Multiply F`i';
  repeat id  d(?a,k?,?b)*d(?c,k?,?d) = d(?a,?c,k,?b,?d);
  Symmetrize d;
  repeat id  d(?a,k?,k?,?b) = d(?a,k,?b);
  #do d = 1,`D'
    id  d(k`i',?a,k1?kk0[x],?b,k2?kk`d'[x],?c) = 0;
  #enddo
  id,ifmatch->1,d(k`i',k?) = 1;
  id,ifmatch->1,d(k`i',?b) = d(?b);
  Multiply acc([q-1]+1);
  Label 1;
  id d = 1;
  .sort:`i';
#enddo
.sort
PolyFun;
id  acc(x?) = x;
id,[q-1] = q-1;
.sort
*--#[ check
Drop;
Local diff = F - (
      -1004963459278518290553920663059825729370295137458150588279060792455043740180417*q
      +48159662638292261464563816049089001899355290060698944017506822529466890777087147*q^2
      -1156915206966957169675212659729197561008578963019961674136579601333076190442291321*q^3
      +18576129228145240976540163793390368151559762747561470325716877905420585805163459952*q^4
      -224287207708388966583370252418215918907248028754302705048891202992707141151105522989*q^5
      +2172106670941779482881454414344105965545288027640336724174126853810275814733672153791*q^6
      -17575701101753281638924509586366726121943195848767512802682040152791514561876077176481*q^7
      +122215983278577506589507747096419022162650589828300259758727510398073863691188262259108*q^8
      -745542618221255279171090922939715751818076034533710344682576633755966369315655935287882*q^9
      +4052957018241045349697915756504064725509388748607876996632255803347828869894601900256986*q^10
      -19879449846639568672447413344544626464721837570318890551174263188707324349869578050548883*q^11
      +88861481755418544201867846779093364099637889354980241740506329954560649625964667163913486*q^12
      -364988766815986022174536392750464885309610483998808586423757593176082904808666021116749678*q^13
      +1387079337006156097944590809103027853606518702313109394277866728875398071216161614018060524*q^14
      -4905983444663627502105895501948664694269783064864204627506176512021027402013229812530193570*q^15
      +16230886832868564500452697932091905225873320414736886645435986901537655227724563847080725154*q^16
      -50448559314946405837617819919375644747048477224593486127695336255925140686351417182521483161*q^17
      +147879365890755658732317101841490574228098105753643177767234098215798919223306372102990830811*q^18
      -410189106086704527219564138136131384816371107680872808029492572357468738406167882062294788654*q^19
      +1079888955800442923413482874086120631366725218941132189822421804473738269858326341979113338449*q^20
      -2705538782732299080717271941162290470377053279954875478591777897153769416427059387465139852270*q^21
      +6466217192810399165829890996592154031143166545850135355840525071906282089280908712907931846665*q^22
      -14774349680701298526879633090295963940163128680972463472228001800887815120339754850737665292683*q^23
      +32335451055005106602278008825041805127909119778028161850978750488864015160747292126466347905731*q^24
      -67910261413775554303310120167342907857321969210754288161578814533147560824347137315218675323393*q^25
      +137082923726531154131474185028354624507377553803250188468890328346933967571103005210954579704698*q^26
      -266359665812480868498546676546061959656887841858835338126368449749782195873100589462059059540950*q^27
      +498865342111136138142419533220081324574972124556410262746540808975103624235151524656706645332230*q^28
      -901723514638687076924283095356393192742000384502001721305303883325189746471311110339229269848411*q^29
      +1574859800431465257158763763255151017165338210688332992642321117621661817562081681450662341972814*q^30
      -2660444903491084236463392116556286947062436475723122227022286130352685068292287352972549363203632*q^31
      +4351529196502743010447526067990471777623416712506011595062832972353021853912913068200126349006667*q^32
      -6897718237406492631018190925462478618130693798851948292666232904452635307153411105853238598329184*q^33
      +10605172336045767134291472785908479083291981594219862720571395441500868584511429128591289915938301*q^34
      -15828008296053675482463716798702234311024718635057658446319010140363069367633998519276964940608497*q^35
      +22948566248254633843037215616843273591758940167913179624645078045068494285509203038362234007203957*q^36
      -32345140860087356789891495886063851617827848426158059279191083343794833668830211934688008452860618*q^37
      +44347682289660014141974125347264499257354262790126067941379546309107097908367759736296654280024090*q^38
      -59184463248343254364880311067859586512436912126042129296685592509501122065253511359405847860542992*q^39
      +76925381592744868526109714857343043019243572020152087208156039889889318094552367108889959101987152*q^40
      -97429850138019496390035971277604268315062439403932802409098002094412277860425931334190531794786766*q^41
      +120308487268730538650696292557129607530403548916557920910373503020711056495729109615696368010924949*q^42
      -144907535496911297784721096180200057318645223946889441565687422839578733698441708632631356522314867*q^43
      +170322837850268806457977191170845865194956431127765218722250552022280138837252650591260788717281137*q^44
      -195446416102051075903855601730077179182568876970708339837052151429264158769597706666344977782134811*q^45
      +219043758625831226613611734103173321138418542352645908928613953842995864141727935602791670152477469*q^46
      -239854714415915428628826051846904403653986965631498384257974266766951057711245872578633951823357938*q^47
      +256706436762025233305996132694441155985596999265386974531041048137860134304164450346246520522537038*q^48
      -268624078510386076419177315588663232611489221568843314047223530664355243057312942766197205738124603*q^49
      +274924550637681982443289305951730698608867512074156094226249765198051917664659969310048719151455788*q^50
      -275280779008852650547306546298887966620479976164491276699402830742612729735734775516190354124959809*q^51
      +269748166430843069298116260254965317070785779488268793101021742068690437457760032435062673630255959*q^52
      -258750579621612701346855025149366310237185480308795890095547108156433680404844529670506032431870456*q^53
      +243029068939072876375911812925336940830512715314933602870435407199640576630694072276842240058858884*q^54
      -223561616259959666509439778805813929999774086669180865346481017335238060848654605812437209659093946*q^55
      +201465638959199643088012024712850792899099369867963487795957518137324776177294670683143170130708599*q^56
      -177896289173722287171635118776836751585140842203984089007701648029650407706324907560325356536113268*q^57
      +153952761522522682610091807474559264404109913919652603188670047098613520848298119608214584703535516*q^58
      -130602248007437184957499286091853651485532407099759002048622138028083936394358466019757010278141326*q^59
      +108627519380197402416110539053074030879915138037833473924667954055846688298133498629529496137653769*q^60
      -88600133576030445937220194220417778668602097426832566145926056140693815890420143497479935476683490*q^61
      +70877673968746168998344237116749246803270785835137287097407951829825601462954830796856366449102241*q^62
      -55620712025881749239400452017593556693035685371802521742838915027860466721604855090008594484659993*q^63
      +42823625695001743789313086233852510870221416950246858985709831567568562390821715141393767654490022*q^64
      -32352990858024741647893808312548916650755814207160949701192668630951095557242085984852131929362534*q^65
      +23987805270387114117052705609518152504448546636093196460867473015873982808395333973034585132196561*q^66
      -17456993115997524909287856317298805525594879954366115902467575688108170274561312689102495710163117*q^67
      +12471132911401459713835493338150995869533464940253965190119560501676023940824754200204677124043057*q^68
      -8746849569442337185040773334506021770331362053610937624575334130887724537833421855319755117126031*q^69
      +6023592579238601920875165045566921624752457683450297021745900002412907647986894595624498281368947*q^70
      -4073463843248968542683890438902887359299620888646244857892210065382656553630736169930707589668818*q^71
      +2705328491573022985065841623339809641630862641463006138734198153922934346856266193310922573291403*q^72
      -1764676004141287773551901259261305636440455251552237743240389726585492991915726308947218461680243*q^73
      +1130673695605294450013582046166211859551216489890730755235687879462227350168576376724437307601948*q^74
      -711660798457400666856016957216929006730012279541683243301370423030357864661667794374725246624175*q^75
      +440054067573389350494368352462454683894824328261787655581883969097003063274863855529984912900980*q^76
      -267342387773603913049653350813725686754478884797381321821051121337724730137752043230230662361946*q^77
      +159583413861208358796819399772163334390914115418004435731170130649988445909838681956867898934943*q^78
      -93603708756244521927639245600147916644498571876911779236165739343581584992743529780736470969909*q^79
      +53952167231864441993617266242157630506303652178345459876774732211275837928651378279964148966930*q^80
      -30560355213900537092564868010671629654086433544898109742730266027914377560335119235297566921500*q^81
      +17012287760535394126762064283216562310947726016916523774268861250557718218424180422272255740685*q^82
      -9307672208125065815433461806018257538436367722263158232374945693588412516536070397285325813454*q^83
      +5005077428693113284332708264771057054988528084047376399687075439939813480822240348143383194336*q^84
      -2645375597095665033386067831431096101803002103251283213281141119077052787842742610119415315751*q^85
      +1374308847505526795641093693365352279290342468450377329292570376975079203837960131215801682786*q^86
      -701800438935477044333753368566912159260219340516954441094968694089218904616431940376382881452*q^87
      +352277810397204924490651782515118151932490191998577167087606146746852859621154834877909576225*q^88
      -173823151702110333592294168676902126420430234006724942491060646356429974959973099192369315140*q^89
      +84311579454239770946194027797567350644169020981868782261594096633196236936824523865959051462*q^90
      -40200272004937811498791490581037568063845747259333284165362300965023409539285300869243722791*q^91
      +18842395593506798465562728401325380933286540760313768059407650389493456942967110775450587148*q^92
      -8681806963538037063431031331583995935124351080707807377263314586587737553412995504056995659*q^93
      +3932338298360388323924704970523799629040918442908886597545137532902469037151743622716380353*q^94
      -1750880734825154579931058305131733088672614739884183033568044327198537575031233566956331082*q^95
      +766343986550112731067252688555426010958652689685175580579664081234407023333007642791577316*q^96
      -329721566377105219911475534993605723207690085885002870096057226232920229152543565569859275*q^97
      +139450680204935885691705499271105630895058727781614606765407059271998290980760630242246640*q^98
      -57974262535133194644112171235025877734334672051498608117236720787298575748530704368307509*q^99
      +23690876611809072757839390648182108908473663799051328370441500559536576828740368231383513*q^100
      -9515829967195681825988311241880246870248758573542937922026195187473804011859056977736025*q^101
      +3756804107847715638685561118879720387280880492157705911644413794814884559504587603005913*q^102
      -1457745770600059488806359908806379486267421203367160776099167228525944899419724556350937*q^103
      +555929538329054611654699364345294623090747955501371981188919492741940298231609082313144*q^104
      -208359881852774347333216498687550266941649687654923629726609507524330602845419348977645*q^105
      +76744068566460261950482968058244650474595497544144925930756892803764633721311644953706*q^106
      -27777308091521560823445777641899436441980089797898244229042307520775252835089395546120*q^107
      +9879310354822360855419720855269698430675797494736487257149226937965682650240709612298*q^108
      -3452462707589792616877378049028597361205784888666168869141699916025008282728692048929*q^109
      +1185414487918511928693809825239327763320450499990710227112567398556460161846882339835*q^110
      -399872459444510945631610818430952524897318605632793722042860205788387018946374822957*q^111
      +132511052792000841251729145308371572096146305186939391172950193828260343859735391443*q^112
      -43134970662478629728284790234129668469819540705327839485086213287095442349862214530*q^113
      +13791745538093949052171218012960273704431820441763178365145209688239966000723174165*q^114
      -4330967012458953215815216228837345121134845329875950530302184837772550891053738929*q^115
      +1335635711530506076748097358348115191479019669050679068465155412091085016022450177*q^116
      -404471788381414482996723573251185253452699671226221875308648921132588025383135887*q^117
      +120266034311475953528075672742715895603241107161050317511374474279537215005462779*q^118
      -35108124514003902909531914677397052563191698432009290608587252424819252934981585*q^119
      +10060864596337919108115722473693567556177554909154769596456231770643143396283301*q^120
      -2829937957724367942510580290417501045895328498410092575093659164003056512884410*q^121
      +781233843359047152528517198676448857027536107598510024800653040494033365085717*q^122
      -211638129682102104755631042500340758454282203907469118243786996203009565196960*q^123
      +56254758762504362640607780135410358577273625318621513903517451827032335119579*q^124
      -14669601890637747425658394037759222299114225573200519756898279698148904372198*q^125
      +3752405033505700845289625095914633164993616099612648396618115718752201465475*q^126
      -941389440934729883003105940866558055671029780288132253499621939794680564093*q^127
      +231595588499406386262283952363685785309530954390523011903244004750296308297*q^128
      -55862814250973027942208367987827523057578048560905192089345745652443006432*q^129
      +13209127357823440768006429227372058503699056950119528917747786907482695500*q^130
      -3061317244179781785268872640985868039949761819097395629945242697696984330*q^131
      +695258504555870831472319789223411304840277867161985243838897640995846987*q^132
      -154705425756536258265641407019173087744622835264638444855275284385690532*q^133
      +33720968542166323637481923701295020597054633954725205732984289326077988*q^134
      -7198468960374271390849406516794190297677509039281287479781413584044105*q^135
      +1504639171489038733145381695204719689305538718953552105595185580543174*q^136
      -307878435168086053558084563782631560993864658217054423088855441787815*q^137
      +61656552754626153229398343431283063996627176846331665926611960798472*q^138
      -12081651250436065901633007496333592324043900585509920040976262844721*q^139
      +2315847162055645672549367044091626652434495397331750056401714940112*q^140
      -434124903440316167440693415949376543825840022409495553530322265743*q^141
      +79564683948358636906456004769593942421993593871322485154733645646*q^142
      -14252831707704000214698683445805944256840374167526301406108894464*q^143
      +2494743550701700506302592476895222634203352703410290803537890265*q^144
      -426537761135533559193186659893691759545533678922604030441339641*q^145
      +71211900367210995994067774311195610622609737546470956972939638*q^146
      -11605432168108533479976318965362546533092092677848370870453531*q^147
      +1845554676753751483534329372186136531922839699026145634698099*q^148
      -286276192161053015635836861515397376667128923997121197718397*q^149
      +43297650673920409887270241691429219729104201966583801809247*q^150
      -6382399795295050631501342260306198875281751900752319861353*q^151
      +916548029975740031592101111826037794765540745797929734861*q^152
      -128167995281958291347682475938226559826748380640422886282*q^153
      +17444103843501660469377928439506596086038550457445485755*q^154
      -2309634722824039620743705355976582071791185355493335629*q^155
      +297325998103776654232480610824484543912498791399701214*q^156
      -37194137838591345392751432357498236316405705630946311*q^157
      +4518684108830218116732119231139401650754114333531106*q^158
      -532813166932753392182870639754017191775899272332016*q^159
      +60936518029534004620798461023013738802703646051573*q^160
      -6754880349342660355041587642124273116583398583452*q^161
      +725228129239324041789090282335097691027776853488*q^162
      -75354402269416452141847903280645121915454583355*q^163
      +7571089581433768026509614726858122308665462299*q^164
      -734918900901936153618937532854730799106085527*q^165
      +68855999340458667979846254419280956954531195*q^166
      -6220533209757993222811611881407484904028642*q^167
      +541287817648467008739317502291400519655577*q^168
      -45314904292359282459124544847275146478786*q^169
      +3645236657830740890874859626514566076485*q^170
      -281384369694707975016503670415989013348*q^171
      +20812998577901109106665152877960790706*q^172
      -1472814520059874008996741131601661679*q^173
      +99540347997415859885246000619718550*q^174
      -6413273074265022608178193291157122*q^175
      +393101784169648949534056946556926*q^176
      -22871911906936257371863571723500*q^177
      +1260080550568971682802543804753*q^178
      -65554282370956883671548186678*q^179
      +3210564731169686996989624416*q^180
      -147518724875838246002577278*q^181
      +6334487547187776753904179*q^182
      -253077147148680782077384*q^183
      +9359722086928112181691*q^184
      -318549564567985915220*q^185
      +9907897251154374494*q^186
      -279309077526286412*q^187
      +7065381584869137*q^188
      -158398432395306*q^189
      +3098161567644*q^190
      -51790840452*q^191
      +719408742*q^192
      -7971795*q^193
      +66066*q^194
      -364*q^195
      +q^196
	);
.sort
#if `ZERO_diff' == 0
	#message Error in 14,2 result
	#terminate
#endif
*--#]
.end

